<!DOCTYPE html>
<html lang="en-us">
  <head>
    
    <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="generator" content="Hugo 0.68.3 with theme Tranquilpeak 0.4.7-BETA">
<meta name="author" content="Notebook">
<meta name="keywords" content="">
<meta name="description" content="">


<meta property="og:description" content="">
<meta property="og:type" content="article">
<meta property="og:title" content="LC 121 123 188 122 309 714 - Best Time to Buy and Sell Stock">
<meta name="twitter:title" content="LC 121 123 188 122 309 714 - Best Time to Buy and Sell Stock">
<meta property="og:url" content="https://yy-zhou.github.io/2020/03/lc-121-123-188-122-309-714-best-time-to-buy-and-sell-stock/">
<meta property="twitter:url" content="https://yy-zhou.github.io/2020/03/lc-121-123-188-122-309-714-best-time-to-buy-and-sell-stock/">
<meta property="og:site_name" content="Bingo!">
<meta property="og:description" content="">
<meta name="twitter:description" content="">
<meta property="og:locale" content="en-us">

  
    <meta property="article:published_time" content="2020-03-21T00:00:00">
  
  
    <meta property="article:modified_time" content="2020-03-21T00:00:00">
  
  
  
  
    
      <meta property="article:tag" content="Dynamic Programming">
    
      <meta property="article:tag" content="State Machine">
    
      <meta property="article:tag" content="Greedy">
    
  


<meta name="twitter:card" content="summary">











  <meta property="og:image" content="https://yy-zhou.github.io/img/avatar.jpg">
  <meta property="twitter:image" content="https://yy-zhou.github.io/img/avatar.jpg">


    <title>LC 121 123 188 122 309 714 - Best Time to Buy and Sell Stock</title>

    <link rel="icon" href="https://yy-zhou.github.io/favicon.png">
    

    

    <link rel="canonical" href="https://yy-zhou.github.io/2020/03/lc-121-123-188-122-309-714-best-time-to-buy-and-sell-stock/">

    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.4/jquery.fancybox.min.css" integrity="sha256-vuXZ9LGmmwtjqFX1F+EKin1ThZMub58gKULUyf0qECk=" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.4/helpers/jquery.fancybox-thumbs.min.css" integrity="sha256-SEa4XYAHihTcEP1f5gARTB2K26Uk8PsndQYHQC1f4jU=" crossorigin="anonymous" />
    
    
    <link rel="stylesheet" href="https://yy-zhou.github.io/css/style-twzjdbqhmnnacqs0pwwdzcdbt8yhv8giawvjqjmyfoqnvazl0dalmnhdkvp7.min.css" />
    
    
      
        <link rel="stylesheet"  href="https://yy-zhou.github.io/css/about.css">
      
    

    
      
    
    
  </head>

  <body>
    <div id="blog">
      <header id="header" data-behavior="2">
  <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
  <div class="header-title">
    <a class="header-title-link" href="https://yy-zhou.github.io/">Bingo!</a>
  </div>
  
    
      <a class="header-right-picture "
         href="https://yy-zhou.github.io/about">
    
    
    
      
        <img class="header-picture" src="https://yy-zhou.github.io/img/avatar.jpg" alt="Author&#39;s picture" />
      
    
    </a>
  
</header>

      <nav id="sidebar" data-behavior="2">
  <div class="sidebar-container">
    
      <div class="sidebar-profile">
        <a href="https://yy-zhou.github.io/about">
          <img class="sidebar-profile-picture" src="https://yy-zhou.github.io/img/avatar.jpg" alt="Author&#39;s picture" />
        </a>
        <h4 class="sidebar-profile-name">Notebook</h4>
        
          <h5 class="sidebar-profile-bio">Bingo!</h5>
        
      </div>
    
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://yy-zhou.github.io/">
    
      <i class="sidebar-button-icon fa fa-lg fa-home"></i>
      
      <span class="sidebar-button-desc">Home</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://yy-zhou.github.io/categories/notes/">
    
      <i class="sidebar-button-icon fa fa-lg fa-sticky-note"></i>
      
      <span class="sidebar-button-desc">Notebook</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://yy-zhou.github.io/categories">
    
      <i class="sidebar-button-icon fa fa-lg fa-bookmark"></i>
      
      <span class="sidebar-button-desc">Categories</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://yy-zhou.github.io/tags">
    
      <i class="sidebar-button-icon fa fa-lg fa-tags"></i>
      
      <span class="sidebar-button-desc">Tags</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://yy-zhou.github.io/archives">
    
      <i class="sidebar-button-icon fa fa-lg fa-archive"></i>
      
      <span class="sidebar-button-desc">Archives</span>
    </a>
  </li>


    </ul>
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://github.com/yy-zhou" target="_blank" rel="noopener">
    
      <i class="sidebar-button-icon fa fa-lg fa-github"></i>
      
      <span class="sidebar-button-desc">GitHub</span>
    </a>
  </li>


    </ul>
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://yy-zhou.github.io/index.xml">
    
      <i class="sidebar-button-icon fa fa-lg fa-rss"></i>
      
      <span class="sidebar-button-desc">RSS</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://github.com/yyzhou95/yyzhou95.github.io" target="_blank" rel="noopener">
    
      <i class="sidebar-button-icon fa fa-lg fa-link"></i>
      
      <span class="sidebar-button-desc">Source Code</span>
    </a>
  </li>


    </ul>
  </div>
</nav>

      

      <div id="main" data-behavior="2"
        class="
               hasCoverMetaOut
               ">
        <article class="post" itemscope itemType="http://schema.org/BlogPosting">
          
          
            <div class="post-header main-content-wrap text-left">
  
    <h1 class="post-title" itemprop="headline">
      LC 121 123 188 122 309 714 - Best Time to Buy and Sell Stock
    </h1>
  
  
  <div class="postShorten-meta post-meta">
    
      <time itemprop="datePublished" datetime="2020-03-21T00:00:00Z">
        
  March 21, 2020

      </time>
    
    
  </div>

</div>
          
          <div class="post-content markdown" itemprop="articleBody">
            <div class="main-content-wrap">
              <h1 id="table-of-contents">Table of Contents</h1><nav id="TableOfContents">
  <ul>
    <li><a href="#121-best-time-to-buy-and-sell-stock">121. Best Time to Buy and Sell Stock</a>
      <ul>
        <li><a href="#problem-description">Problem description</a></li>
        <li><a href="#method--code">Method &amp; Code</a>
          <ul>
            <li><a href="#dynamic-programming">Dynamic Programming</a></li>
            <li><a href="#greedy">Greedy</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#123-best-time-to-buy-and-sell-stock-iii">123. Best Time to Buy and Sell Stock III</a>
      <ul>
        <li><a href="#problem-description-1">Problem description</a></li>
        <li><a href="#method--code-1">Method &amp; Code</a>
          <ul>
            <li><a href="#dynamic-programming-1">Dynamic Programming</a></li>
            <li><a href="#state-machine">State Machine</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#188-best-time-to-buy-and-sell-stock-iv">188. Best Time to Buy and Sell Stock IV</a>
      <ul>
        <li><a href="#problem-description-2">Problem description</a></li>
        <li><a href="#method--code-2">Method &amp; Code</a>
          <ul>
            <li><a href="#dynamic-programming-2">Dynamic Programming</a></li>
            <li><a href="#dp-solution-with-space-optimization">DP Solution with Space Optimization</a></li>
            <li><a href="#state-machine-1">State machine</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#122-best-time-to-buy-and-sell-stock-ii">122. Best Time to Buy and Sell Stock II</a>
      <ul>
        <li><a href="#problem-description-3">Problem description</a></li>
        <li><a href="#method--code-3">Method &amp; Code</a>
          <ul>
            <li><a href="#dynamic-programming-3">Dynamic Programming</a></li>
            <li><a href="#greedy-1">Greedy</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#309-best-time-to-buy-and-sell-stock-with-cooldown">309. Best Time to Buy and Sell Stock with Cooldown</a>
      <ul>
        <li><a href="#problem-description-4">Problem description</a></li>
        <li><a href="#method--code-4">Method &amp; Code</a>
          <ul>
            <li><a href="#dynamic-programming-4">Dynamic Programming</a></li>
            <li><a href="#optimized-dynamic-programming">Optimized Dynamic Programming</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#714-best-time-to-buy-and-sell-stock-with-transaction-fee">714. Best Time to Buy and Sell Stock with Transaction Fee</a>
      <ul>
        <li><a href="#problem-description-5">Problem description</a></li>
        <li><a href="#method--code-5">Method &amp; Code</a>
          <ul>
            <li><a href="#dynamic-programming-5">Dynamic Programming</a></li>
            <li><a href="#optimized-dynamic-programming-1">Optimized Dynamic Programming</a></li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>
</nav>
<h1 id="121-best-time-to-buy-and-sell-stock">121. Best Time to Buy and Sell Stock</h1>
<p>Link: <a href="https://leetcode.com/problems/best-time-to-buy-and-sell-stock">Best Time to Buy and Sell Stock</a></p>
<h2 id="problem-description">Problem description</h2>
<p>Say you have an array for which the ith element is the price of a given stock on day i.</p>
<p>If you were only permitted to complete at most one transaction (i.e., buy one and sell one share of the stock), design an algorithm to find the maximum profit.</p>
<p>Note that you cannot sell a stock before you buy one.</p>
<p><strong>Example 1:</strong></p>
<pre><code>Input: [7,1,5,3,6,4]
Output: 5
Explanation: Buy on day 2 (price = 1) and sell on day 5 (price = 6), profit = 6-1 = 5.
             Not 7-1 = 6, as selling price needs to be larger than buying price.
</code></pre><p><strong>Example 2:</strong></p>
<pre><code>Input: [7,6,4,3,1]
Output: 0
Explanation: In this case, no transaction is done, i.e. max profit = 0.
</code></pre><h2 id="method--code">Method &amp; Code</h2>
<p>Dynamic programming.</p>
<p>State transition:</p>
<ul>
<li><code>dp[i] = Math.max(dp[i - 1], prices[i] + min)</code>, where <code>min</code> is the min value from <code>[0, i]</code>.</li>
</ul>
<h3 id="dynamic-programming">Dynamic Programming</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#75715e">/**
</span><span style="color:#75715e"> * Dynamic programming.
</span><span style="color:#75715e"> * Similar to max subarray problem.
</span><span style="color:#75715e"> *
</span><span style="color:#75715e"> * @param prices int array
</span><span style="color:#75715e"> * @return max &#34;profit&#34;
</span><span style="color:#75715e"> */</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">int</span> <span style="color:#a6e22e">maxProfit</span><span style="color:#f92672">(</span><span style="color:#66d9ef">int</span><span style="color:#f92672">[]</span> prices<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>

    <span style="color:#75715e">/* Corner case */</span>
    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>prices <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span> <span style="color:#f92672">||</span> prices<span style="color:#f92672">.</span><span style="color:#a6e22e">length</span> <span style="color:#f92672">&lt;</span> 2<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">return</span> 0<span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>

    <span style="color:#66d9ef">int</span> n <span style="color:#f92672">=</span> prices<span style="color:#f92672">.</span><span style="color:#a6e22e">length</span><span style="color:#f92672">,</span> minBuy <span style="color:#f92672">=</span> prices<span style="color:#f92672">[</span>0<span style="color:#f92672">];</span>     <span style="color:#75715e">// min buy price
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">int</span><span style="color:#f92672">[]</span> dp <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#66d9ef">int</span><span style="color:#f92672">[</span>n<span style="color:#f92672">];</span>

    <span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span><span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> 1<span style="color:#f92672">;</span> i <span style="color:#f92672">&lt;</span> n<span style="color:#f92672">;</span> i<span style="color:#f92672">++)</span> <span style="color:#f92672">{</span>
        minBuy <span style="color:#f92672">=</span> Math<span style="color:#f92672">.</span><span style="color:#a6e22e">min</span><span style="color:#f92672">(</span>minBuy<span style="color:#f92672">,</span> prices<span style="color:#f92672">[</span>i<span style="color:#f92672">]);</span>
        dp<span style="color:#f92672">[</span>i<span style="color:#f92672">]</span> <span style="color:#f92672">=</span> Math<span style="color:#f92672">.</span><span style="color:#a6e22e">max</span><span style="color:#f92672">(</span>dp<span style="color:#f92672">[</span>i <span style="color:#f92672">-</span> 1<span style="color:#f92672">],</span> prices<span style="color:#f92672">[</span>i<span style="color:#f92672">]</span> <span style="color:#f92672">-</span> minBuy<span style="color:#f92672">);</span>       <span style="color:#75715e">// min buy price and max sell price
</span><span style="color:#75715e"></span>    <span style="color:#f92672">}</span>

    <span style="color:#66d9ef">return</span> dp<span style="color:#f92672">[</span>n <span style="color:#f92672">-</span> 1<span style="color:#f92672">];</span>
<span style="color:#f92672">}</span>
</code></pre></div><h3 id="greedy">Greedy</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#75715e">/**
</span><span style="color:#75715e"> * Greedy, actually idea is same as dynamic programming solution.
</span><span style="color:#75715e"> *
</span><span style="color:#75715e"> * @param prices int array
</span><span style="color:#75715e"> * @return max &#34;profit&#34;
</span><span style="color:#75715e"> */</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">int</span> <span style="color:#a6e22e">maxProfitGreedy</span><span style="color:#f92672">(</span><span style="color:#66d9ef">int</span><span style="color:#f92672">[]</span> prices<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">int</span> max <span style="color:#f92672">=</span> 0<span style="color:#f92672">,</span> profit <span style="color:#f92672">=</span> 0<span style="color:#f92672">;</span>
    <span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span><span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> 1<span style="color:#f92672">;</span> i <span style="color:#f92672">&lt;</span> prices<span style="color:#f92672">.</span><span style="color:#a6e22e">length</span><span style="color:#f92672">;</span> i<span style="color:#f92672">++)</span> <span style="color:#f92672">{</span>
        profit <span style="color:#f92672">=</span> Math<span style="color:#f92672">.</span><span style="color:#a6e22e">max</span><span style="color:#f92672">(</span>0<span style="color:#f92672">,</span> prices<span style="color:#f92672">[</span>i<span style="color:#f92672">]</span> <span style="color:#f92672">-</span> prices<span style="color:#f92672">[</span>i <span style="color:#f92672">-</span> 1<span style="color:#f92672">]</span> <span style="color:#f92672">+</span> profit<span style="color:#f92672">);</span>
        max <span style="color:#f92672">=</span> Math<span style="color:#f92672">.</span><span style="color:#a6e22e">max</span><span style="color:#f92672">(</span>max<span style="color:#f92672">,</span> profit<span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>

    <span style="color:#66d9ef">return</span> max<span style="color:#f92672">;</span>
<span style="color:#f92672">}</span>
</code></pre></div><h1 id="123-best-time-to-buy-and-sell-stock-iii">123. Best Time to Buy and Sell Stock III</h1>
<p>Link: <a href="https://leetcode.com/problems/best-time-to-buy-and-sell-stock-iii">Best Time to Buy and Sell Stock III</a></p>
<h2 id="problem-description-1">Problem description</h2>
<p>Say you have an array for which the <em>i</em>th element is the price of a given stock on day <em>i</em>.</p>
<p>Design an algorithm to find the maximum profit. You may complete at most <em>two</em> transactions.</p>
<p><strong>Note:</strong> You may not engage in multiple transactions at the same time (i.e., you must sell the stock before you buy again).</p>
<p><strong>Example 1:</strong></p>
<pre><code>Input: [3,3,5,0,0,3,1,4]
Output: 6
Explanation: Buy on day 4 (price = 0) and sell on day 6 (price = 3), profit = 3-0 = 3.
             Then buy on day 7 (price = 1) and sell on day 8 (price = 4), profit = 4-1 = 3.
</code></pre><p><strong>Example 2:</strong></p>
<pre><code>Input: [1,2,3,4,5]
Output: 4
Explanation: Buy on day 1 (price = 1) and sell on day 5 (price = 5), profit = 5-1 = 4.
             Note that you cannot buy on day 1, buy on day 2 and sell them later, as you are
             engaging multiple transactions at the same time. You must sell before buying again.
</code></pre><p><strong>Example 3:</strong></p>
<pre><code>Input: [7,6,4,3,1]
Output: 0
Explanation: In this case, no transaction is done, i.e. max profit = 0.
</code></pre><h2 id="method--code-1">Method &amp; Code</h2>
<p>The dynamic programming solution is same as Best Time to Buy and Sell Stock IV, check the method in next problem. There is another understanding of this problem: state machine.</p>
<h3 id="dynamic-programming-1">Dynamic Programming</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#75715e">/**
</span><span style="color:#75715e"> * Dynamic programming.
</span><span style="color:#75715e"> * The general state transition to solve this kind of problem is as following:
</span><span style="color:#75715e"> * dp[i, j] = max(dp[i, j - 1], prices[j] - prices[j&#39;] + dp[i - 1, j&#39;])
</span><span style="color:#75715e"> * i: ith transaction (in this case, i &lt;= 2)
</span><span style="color:#75715e"> * j: prices[j], index in int array price
</span><span style="color:#75715e"> * j&#39;: in range of [0, j-1]
</span><span style="color:#75715e"> * =&gt; [i, j] = max([i, j - 1], prices[j] + max([i - 1, j&#39;] - prices[j&#39;]))  (efficient for looping)
</span><span style="color:#75715e"> * Base case:
</span><span style="color:#75715e"> * dp[0, j] = 0
</span><span style="color:#75715e"> * dp[i, 0] = 0
</span><span style="color:#75715e"> *
</span><span style="color:#75715e"> * @param prices given price array
</span><span style="color:#75715e"> * @return maximum profit based on two transactions
</span><span style="color:#75715e"> */</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">int</span> <span style="color:#a6e22e">maxProfit</span><span style="color:#f92672">(</span><span style="color:#66d9ef">int</span><span style="color:#f92672">[]</span> prices<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>

    <span style="color:#75715e">/* Corner case */</span>
    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>prices<span style="color:#f92672">.</span><span style="color:#a6e22e">length</span> <span style="color:#f92672">&lt;</span> 2<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">return</span> 0<span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>

    <span style="color:#66d9ef">int</span> n <span style="color:#f92672">=</span> prices<span style="color:#f92672">.</span><span style="color:#a6e22e">length</span><span style="color:#f92672">;</span>
    <span style="color:#66d9ef">int</span><span style="color:#f92672">[][]</span> dp <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#66d9ef">int</span><span style="color:#f92672">[</span>3<span style="color:#f92672">][</span>n<span style="color:#f92672">];</span>

    <span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span><span style="color:#66d9ef">int</span> k <span style="color:#f92672">=</span> 1<span style="color:#f92672">;</span> k <span style="color:#f92672">&lt;</span> 3<span style="color:#f92672">;</span> k<span style="color:#f92672">++)</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">int</span> min <span style="color:#f92672">=</span> prices<span style="color:#f92672">[</span>0<span style="color:#f92672">];</span>
        <span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span><span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> 1<span style="color:#f92672">;</span> i <span style="color:#f92672">&lt;</span> n<span style="color:#f92672">;</span> i<span style="color:#f92672">++)</span> <span style="color:#f92672">{</span>
            min <span style="color:#f92672">=</span> Math<span style="color:#f92672">.</span><span style="color:#a6e22e">min</span><span style="color:#f92672">(</span>min<span style="color:#f92672">,</span> prices<span style="color:#f92672">[</span>i<span style="color:#f92672">]</span> <span style="color:#f92672">-</span> dp<span style="color:#f92672">[</span>k <span style="color:#f92672">-</span> 1<span style="color:#f92672">][</span>i <span style="color:#f92672">-</span> 1<span style="color:#f92672">]);</span>
            dp<span style="color:#f92672">[</span>k<span style="color:#f92672">][</span>i<span style="color:#f92672">]</span> <span style="color:#f92672">=</span> Math<span style="color:#f92672">.</span><span style="color:#a6e22e">max</span><span style="color:#f92672">(</span>dp<span style="color:#f92672">[</span>k<span style="color:#f92672">][</span>i <span style="color:#f92672">-</span> 1<span style="color:#f92672">],</span> prices<span style="color:#f92672">[</span>i<span style="color:#f92672">]</span> <span style="color:#f92672">-</span> min<span style="color:#f92672">);</span>
        <span style="color:#f92672">}</span>
    <span style="color:#f92672">}</span>

    <span style="color:#66d9ef">return</span> dp<span style="color:#f92672">[</span>2<span style="color:#f92672">][</span>n <span style="color:#f92672">-</span> 1<span style="color:#f92672">];</span>
<span style="color:#f92672">}</span>
</code></pre></div><h3 id="state-machine">State Machine</h3>
<p><img src="../../../img/state-machine.png" alt="state-machine"></p>
<ul>
<li>State 0: do nothing or buy stock</li>
<li>State 1: sell stock or hold purchased stock</li>
<li>State 2: do nothing or buy stock again</li>
<li>State 3: sell stock again or do nothing</li>
</ul>
<p>Finally, it returns the final state <code>s3</code>. If no purchase happened (no profit), then the state machine will directly return -price[0]. Compare the state machine result and return 0 if state machine returns a negative value.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#75715e">/**
</span><span style="color:#75715e"> * Use a state machine to describes the problem statement.
</span><span style="color:#75715e"> * State 0: do nothing or buy stock
</span><span style="color:#75715e"> * State 1: sell stock or hold purchased stock
</span><span style="color:#75715e"> * State 2: do nothing or buy stock again
</span><span style="color:#75715e"> * State 3: sell stock or do nothing
</span><span style="color:#75715e"> * Finally, return the final state s3. If no purchase then it will directly return -price[0].
</span><span style="color:#75715e"> * If final result is negative, then return 0.
</span><span style="color:#75715e"> *
</span><span style="color:#75715e"> * @param prices price int array
</span><span style="color:#75715e"> * @return max profit
</span><span style="color:#75715e"> */</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">int</span> <span style="color:#a6e22e">stateMachine</span><span style="color:#f92672">(</span><span style="color:#66d9ef">int</span><span style="color:#f92672">[]</span> prices<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>

    <span style="color:#75715e">/* Corner case */</span>
    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>prices<span style="color:#f92672">.</span><span style="color:#a6e22e">length</span> <span style="color:#f92672">==</span> 0<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">return</span> 0<span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>

    <span style="color:#66d9ef">int</span> s0 <span style="color:#f92672">=</span> <span style="color:#f92672">-</span>prices<span style="color:#f92672">[</span>0<span style="color:#f92672">],</span> s1 <span style="color:#f92672">=</span> Integer<span style="color:#f92672">.</span><span style="color:#a6e22e">MIN_VALUE</span><span style="color:#f92672">,</span> s2 <span style="color:#f92672">=</span> Integer<span style="color:#f92672">.</span><span style="color:#a6e22e">MIN_VALUE</span><span style="color:#f92672">,</span> s3 <span style="color:#f92672">=</span> Integer<span style="color:#f92672">.</span><span style="color:#a6e22e">MIN_VALUE</span><span style="color:#f92672">;</span>
    <span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span><span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> 1<span style="color:#f92672">;</span> i <span style="color:#f92672">&lt;</span> prices<span style="color:#f92672">.</span><span style="color:#a6e22e">length</span><span style="color:#f92672">;</span> i<span style="color:#f92672">++)</span> <span style="color:#f92672">{</span>
        s0 <span style="color:#f92672">=</span> Integer<span style="color:#f92672">.</span><span style="color:#a6e22e">max</span><span style="color:#f92672">(</span>s0<span style="color:#f92672">,</span> <span style="color:#f92672">-</span>prices<span style="color:#f92672">[</span>i<span style="color:#f92672">]);</span>           <span style="color:#75715e">// state 0
</span><span style="color:#75715e"></span>        s1 <span style="color:#f92672">=</span> Integer<span style="color:#f92672">.</span><span style="color:#a6e22e">max</span><span style="color:#f92672">(</span>s1<span style="color:#f92672">,</span> s0 <span style="color:#f92672">+</span> prices<span style="color:#f92672">[</span>i<span style="color:#f92672">]);</span>       <span style="color:#75715e">// sell stock -&gt; turn to state 1 or do nothing
</span><span style="color:#75715e"></span>        s2 <span style="color:#f92672">=</span> Integer<span style="color:#f92672">.</span><span style="color:#a6e22e">max</span><span style="color:#f92672">(</span>s2<span style="color:#f92672">,</span> s1 <span style="color:#f92672">-</span> prices<span style="color:#f92672">[</span>i<span style="color:#f92672">]);</span>       <span style="color:#75715e">// second buy -&gt; turn to state 2 or do nothing
</span><span style="color:#75715e"></span>        s3 <span style="color:#f92672">=</span> Integer<span style="color:#f92672">.</span><span style="color:#a6e22e">max</span><span style="color:#f92672">(</span>s3<span style="color:#f92672">,</span> s2 <span style="color:#f92672">+</span> prices<span style="color:#f92672">[</span>i<span style="color:#f92672">]);</span>       <span style="color:#75715e">// final state, sell or do nothing
</span><span style="color:#75715e"></span>    <span style="color:#f92672">}</span>
    <span style="color:#66d9ef">return</span> Math<span style="color:#f92672">.</span><span style="color:#a6e22e">max</span><span style="color:#f92672">(</span>s3<span style="color:#f92672">,</span> 0<span style="color:#f92672">);</span>      <span style="color:#75715e">// if the stock price is monotonically decreasing, return 0
</span><span style="color:#75715e"></span><span style="color:#f92672">}</span>
</code></pre></div><h1 id="188-best-time-to-buy-and-sell-stock-iv">188. Best Time to Buy and Sell Stock IV</h1>
<p>Link: <a href="https://leetcode.com/problems/best-time-to-buy-and-sell-stock-iv">Best Time to Buy and Sell Stock IV</a></p>
<h2 id="problem-description-2">Problem description</h2>
<p>Say you have an array for which the <em>i</em> th element is the price of a given stock on day <em>i</em>.</p>
<p>Design an algorithm to find the maximum profit. You may complete at most <strong>k</strong> transactions.</p>
<p><strong>Note:</strong>
You may not engage in multiple transactions at the same time (ie, you must sell the stock before you buy again).</p>
<p><strong>Example 1:</strong></p>
<pre><code>Input: [2,4,1], k = 2
Output: 2
Explanation: Buy on day 1 (price = 2) and sell on day 2 (price = 4), profit = 4-2 = 2.
</code></pre><p><strong>Example 2:</strong></p>
<pre><code>Input: [3,2,6,5,0,3], k = 2
Output: 7
Explanation: Buy on day 2 (price = 2) and sell on day 3 (price = 6), profit = 6-2 = 4.
             Then buy on day 5 (price = 0) and sell on day 6 (price = 3), profit = 3-0 = 3.
</code></pre><h2 id="method--code-2">Method &amp; Code</h2>
<p>There are two approaches to solve this problem (actually they are same): dynamic programming and state machine. The choice is up to which one is understandable.</p>
<p>However, to avoid MLE (happens when k and array are extremely large), some corner cases should be fixed first. If <code>k &gt; prices.length * 2</code>, then the problem can be converted to Best Time to Buy and Sell Stock II. The reason is that in given array, it can at most complete <code>2 * k </code> operations since only one action can be done at one time.</p>
<h3 id="dynamic-programming-2">Dynamic Programming</h3>
<p>State transition:</p>
<pre><code>dp[i, j] = max(dp[i, j - 1], prices[j] - prices[j'] + [i - 1, j'])
</code></pre><ul>
<li><code>i</code>: <code>i</code> th transaction</li>
<li><code>j</code>: <code>prices[j]</code>, index in int array price</li>
<li><code>j'</code>: in range of <code>[0, j-1]</code></li>
</ul>
<p>Therefore, it will be:</p>
<pre><code>dp[i, j] = max(dp[i, j - 1], prices[j] + max(dp[i - 1, j'] - prices[j']))  (efficient for looping)
</code></pre><p>Base cases:</p>
<pre><code>dp[0, j] = 0
dp[i, 0] = 0
</code></pre><p>The naive solution of dp is as following:</p>
<pre><code>for (int i = 1; i &lt;= k; i++) {
    for (int j = 1; j &lt; n; j++) {

        int max = -prices[0];
        for (int m = 0; m &lt; j; m++) {
            max = Math.max(prices[j] - prices[m] + dp[i - 1][m], max);
        }
        dp[i][j] = Math.max(max, dp[i][j - 1]);
    }
}
</code></pre><p>The optimized code is in the code part.</p>
<p>The idea is to find out max profit from previous transaction and compare to current operation (buy/sell, or do nothing). This is actually same as state machine.</p>
<p>Note that in <code>dp[i][j]</code>, only <code>dp[i - 1][t - 1] - price[t]</code> is relating to <code>t</code>, where <code>t</code> is from <code>0</code> to <code>j</code>. Hence, <code>dp[i][j] = price[j] + max(dp[i - 1][t - 1] - price[t])</code>. <code>max(dp[i - 1][t - 1] - price[t])</code> can be found by using a int to store during the loop from <code>0</code> to <code>j</code>.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#75715e">/**
</span><span style="color:#75715e"> * Dynamic programming with 2D table, optimized from O(n^3) to O(n^2).
</span><span style="color:#75715e"> * The original state transition should be:
</span><span style="color:#75715e"> * dp[i, j] = max(dp[i - 1][t - 1] + price[j] - price[t])
</span><span style="color:#75715e"> * dp[i, j]: maximum profit from at most i transactions using prices 0 to j.
</span><span style="color:#75715e"> * i: ith transaction
</span><span style="color:#75715e"> * j: sell at price[j]
</span><span style="color:#75715e"> * t: buy at price[t]
</span><span style="color:#75715e"> * The time complexity will be O(n^2 * k) (three level looping).
</span><span style="color:#75715e"> * To optimize it, note that in dp[i][j], only dp[i - 1][t - 1] - price[t] is relating to t.
</span><span style="color:#75715e"> * Hence, dp[i][j] = price[j] + max(dp[i - 1][t - 1] - price[t]).
</span><span style="color:#75715e"> * max(dp[i - 1][t - 1] - price[t]) can be found by using a int to store during the loop from 0 to j.
</span><span style="color:#75715e"> * Base case:
</span><span style="color:#75715e"> * dp[i, 0] = 0, 0 &lt;= i &lt;= k
</span><span style="color:#75715e"> * dp[0, j] = 0, 0 &lt;= j &lt; n
</span><span style="color:#75715e"> *
</span><span style="color:#75715e"> * @param k      at most k transactions
</span><span style="color:#75715e"> * @param prices int array
</span><span style="color:#75715e"> * @return max profit
</span><span style="color:#75715e"> */</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">int</span> <span style="color:#a6e22e">maxProfit</span><span style="color:#f92672">(</span><span style="color:#66d9ef">int</span> k<span style="color:#f92672">,</span> <span style="color:#66d9ef">int</span><span style="color:#f92672">[]</span> prices<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">int</span> n <span style="color:#f92672">=</span> prices<span style="color:#f92672">.</span><span style="color:#a6e22e">length</span><span style="color:#f92672">;</span>

    <span style="color:#75715e">/* Corner case */</span>
    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>n <span style="color:#f92672">&lt;</span> 2<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">return</span> 0<span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>

    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>k <span style="color:#f92672">&gt;=</span> n <span style="color:#f92672">/</span> 2<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>       <span style="color:#75715e">// k is sufficient for comparing each adjacent value in array
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">int</span> max <span style="color:#f92672">=</span> 0<span style="color:#f92672">;</span>
        <span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span><span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> 1<span style="color:#f92672">;</span> i <span style="color:#f92672">&lt;</span> n<span style="color:#f92672">;</span> i<span style="color:#f92672">++)</span> <span style="color:#f92672">{</span>
            <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>prices<span style="color:#f92672">[</span>i<span style="color:#f92672">]</span> <span style="color:#f92672">-</span> prices<span style="color:#f92672">[</span>i <span style="color:#f92672">-</span> 1<span style="color:#f92672">]</span> <span style="color:#f92672">&gt;</span> 0<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
                max <span style="color:#f92672">+=</span> prices<span style="color:#f92672">[</span>i<span style="color:#f92672">]</span> <span style="color:#f92672">-</span> prices<span style="color:#f92672">[</span>i <span style="color:#f92672">-</span> 1<span style="color:#f92672">];</span>
            <span style="color:#f92672">}</span>
        <span style="color:#f92672">}</span>
        <span style="color:#66d9ef">return</span> max<span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>

    <span style="color:#66d9ef">int</span><span style="color:#f92672">[][]</span> dp <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#66d9ef">int</span><span style="color:#f92672">[</span>k <span style="color:#f92672">+</span> 1<span style="color:#f92672">][</span>n<span style="color:#f92672">];</span>     <span style="color:#75715e">// dp[i][j]: maximum profit from at most i transactions using prices 0 to j
</span><span style="color:#75715e"></span>
    <span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span><span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> 1<span style="color:#f92672">;</span> i <span style="color:#f92672">&lt;=</span> k<span style="color:#f92672">;</span> i<span style="color:#f92672">++)</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">int</span> maxTemp <span style="color:#f92672">=</span> <span style="color:#f92672">-</span>prices<span style="color:#f92672">[</span>0<span style="color:#f92672">];</span>     <span style="color:#75715e">// max profit from previous round
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span><span style="color:#66d9ef">int</span> j <span style="color:#f92672">=</span> 1<span style="color:#f92672">;</span> j <span style="color:#f92672">&lt;</span> n<span style="color:#f92672">;</span> j<span style="color:#f92672">++)</span> <span style="color:#f92672">{</span>           <span style="color:#75715e">// each row is one more buying taken based on previous max profit
</span><span style="color:#75715e"></span>
            <span style="color:#75715e">/*
</span><span style="color:#75715e">             * dp[i, j] = max(dp[i - 1][t - 1] + price[j] - price[t]), where t is from 0 to j
</span><span style="color:#75715e">             * dp[i][j - 1]: do nothing (or buy) which doesn&#39;t change the acquired profit
</span><span style="color:#75715e">             * prices[j] - buyPrice: sell at current price
</span><span style="color:#75715e">             * maxTemp is to find max(dp[i - 1][t - 1] - price[t])
</span><span style="color:#75715e">             * t is from 0 to j. */</span>
            dp<span style="color:#f92672">[</span>i<span style="color:#f92672">][</span>j<span style="color:#f92672">]</span> <span style="color:#f92672">=</span> Math<span style="color:#f92672">.</span><span style="color:#a6e22e">max</span><span style="color:#f92672">(</span>dp<span style="color:#f92672">[</span>i<span style="color:#f92672">][</span>j <span style="color:#f92672">-</span> 1<span style="color:#f92672">],</span> prices<span style="color:#f92672">[</span>j<span style="color:#f92672">]</span> <span style="color:#f92672">-</span> maxTemp<span style="color:#f92672">);</span>
            maxTemp <span style="color:#f92672">=</span> Math<span style="color:#f92672">.</span><span style="color:#a6e22e">max</span><span style="color:#f92672">(</span>maxTemp<span style="color:#f92672">,</span> dp<span style="color:#f92672">[</span>i <span style="color:#f92672">-</span> 1<span style="color:#f92672">][</span>j<span style="color:#f92672">]</span> <span style="color:#f92672">-</span> prices<span style="color:#f92672">[</span>j<span style="color:#f92672">]);</span>
        <span style="color:#f92672">}</span>
    <span style="color:#f92672">}</span>

    <span style="color:#66d9ef">return</span> dp<span style="color:#f92672">[</span>k<span style="color:#f92672">][</span>n <span style="color:#f92672">-</span> 1<span style="color:#f92672">];</span>
<span style="color:#f92672">}</span>
</code></pre></div><h3 id="dp-solution-with-space-optimization">DP Solution with Space Optimization</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#75715e">/**
</span><span style="color:#75715e"> * DP solution with space optimized by rolling array.
</span><span style="color:#75715e"> *
</span><span style="color:#75715e"> * @param k      k times transaction limit
</span><span style="color:#75715e"> * @param prices prices array
</span><span style="color:#75715e"> * @return max profit from the array
</span><span style="color:#75715e"> */</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">int</span> <span style="color:#a6e22e">dpOptimized</span><span style="color:#f92672">(</span><span style="color:#66d9ef">int</span> k<span style="color:#f92672">,</span> <span style="color:#66d9ef">int</span><span style="color:#f92672">[]</span> prices<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>

    <span style="color:#75715e">/* Corner case */</span>
    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>prices<span style="color:#f92672">.</span><span style="color:#a6e22e">length</span> <span style="color:#f92672">&lt;</span> 2<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">return</span> 0<span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>

    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>k <span style="color:#f92672">&gt;=</span> prices<span style="color:#f92672">.</span><span style="color:#a6e22e">length</span> <span style="color:#f92672">/</span> 2<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>       <span style="color:#75715e">// k is sufficient for comparing each adjacent value in array
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">int</span> max <span style="color:#f92672">=</span> 0<span style="color:#f92672">;</span>
        <span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span><span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> 1<span style="color:#f92672">;</span> i <span style="color:#f92672">&lt;</span> prices<span style="color:#f92672">.</span><span style="color:#a6e22e">length</span><span style="color:#f92672">;</span> i<span style="color:#f92672">++)</span> <span style="color:#f92672">{</span>
            <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>prices<span style="color:#f92672">[</span>i<span style="color:#f92672">]</span> <span style="color:#f92672">-</span> prices<span style="color:#f92672">[</span>i <span style="color:#f92672">-</span> 1<span style="color:#f92672">]</span> <span style="color:#f92672">&gt;</span> 0<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
                max <span style="color:#f92672">+=</span> prices<span style="color:#f92672">[</span>i<span style="color:#f92672">]</span> <span style="color:#f92672">-</span> prices<span style="color:#f92672">[</span>i <span style="color:#f92672">-</span> 1<span style="color:#f92672">];</span>
            <span style="color:#f92672">}</span>
        <span style="color:#f92672">}</span>
        <span style="color:#66d9ef">return</span> max<span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>

    <span style="color:#66d9ef">int</span><span style="color:#f92672">[]</span> r1 <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#66d9ef">int</span><span style="color:#f92672">[</span>prices<span style="color:#f92672">.</span><span style="color:#a6e22e">length</span><span style="color:#f92672">];</span>
    <span style="color:#66d9ef">int</span><span style="color:#f92672">[]</span> r2 <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#66d9ef">int</span><span style="color:#f92672">[</span>prices<span style="color:#f92672">.</span><span style="color:#a6e22e">length</span><span style="color:#f92672">];</span>

    <span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span><span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> 1<span style="color:#f92672">;</span> i <span style="color:#f92672">&lt;</span> k <span style="color:#f92672">+</span> 1<span style="color:#f92672">;</span> i<span style="color:#f92672">++)</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">int</span> base <span style="color:#f92672">=</span> <span style="color:#f92672">-</span>prices<span style="color:#f92672">[</span>0<span style="color:#f92672">];</span>

        <span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span><span style="color:#66d9ef">int</span> j <span style="color:#f92672">=</span> 1<span style="color:#f92672">;</span> j <span style="color:#f92672">&lt;</span> r1<span style="color:#f92672">.</span><span style="color:#a6e22e">length</span><span style="color:#f92672">;</span> j<span style="color:#f92672">++)</span> <span style="color:#f92672">{</span>
            r2<span style="color:#f92672">[</span>j<span style="color:#f92672">]</span> <span style="color:#f92672">=</span> Math<span style="color:#f92672">.</span><span style="color:#a6e22e">max</span><span style="color:#f92672">(</span>r2<span style="color:#f92672">[</span>j <span style="color:#f92672">-</span> 1<span style="color:#f92672">],</span> prices<span style="color:#f92672">[</span>j<span style="color:#f92672">]</span> <span style="color:#f92672">+</span> base<span style="color:#f92672">);</span>
            base <span style="color:#f92672">=</span> Math<span style="color:#f92672">.</span><span style="color:#a6e22e">max</span><span style="color:#f92672">(</span>base<span style="color:#f92672">,</span> r1<span style="color:#f92672">[</span>j<span style="color:#f92672">]</span> <span style="color:#f92672">-</span> prices<span style="color:#f92672">[</span>j<span style="color:#f92672">]);</span>
        <span style="color:#f92672">}</span>

        <span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span><span style="color:#66d9ef">int</span> j <span style="color:#f92672">=</span> 0<span style="color:#f92672">;</span> j <span style="color:#f92672">&lt;</span> prices<span style="color:#f92672">.</span><span style="color:#a6e22e">length</span><span style="color:#f92672">;</span> j<span style="color:#f92672">++)</span> <span style="color:#f92672">{</span>       <span style="color:#75715e">// memory compress
</span><span style="color:#75715e"></span>            r1<span style="color:#f92672">[</span>j<span style="color:#f92672">]</span> <span style="color:#f92672">=</span> r2<span style="color:#f92672">[</span>j<span style="color:#f92672">];</span>
            r2<span style="color:#f92672">[</span>j<span style="color:#f92672">]</span> <span style="color:#f92672">=</span> 0<span style="color:#f92672">;</span>
        <span style="color:#f92672">}</span>
    <span style="color:#f92672">}</span>

    <span style="color:#66d9ef">return</span> r1<span style="color:#f92672">[</span>prices<span style="color:#f92672">.</span><span style="color:#a6e22e">length</span> <span style="color:#f92672">-</span> 1<span style="color:#f92672">];</span>
<span style="color:#f92672">}</span>
</code></pre></div><h3 id="state-machine-1">State machine</h3>
<p>It is same as previous problem, which is actually k=2 if use condition in this problem. The state machine has <code>k * 2</code> states, and to store them, use a <code>int[]</code> to store the states and update it.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#75715e">/**
</span><span style="color:#75715e"> * Use a state machine to save state.
</span><span style="color:#75715e"> * The length of state is 2 * k, since each k representing a buy and sell state.
</span><span style="color:#75715e"> *
</span><span style="color:#75715e"> * @param k      at most k transactions
</span><span style="color:#75715e"> * @param prices given int array
</span><span style="color:#75715e"> * @return max profit
</span><span style="color:#75715e"> */</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">int</span> <span style="color:#a6e22e">stateMachine</span><span style="color:#f92672">(</span><span style="color:#66d9ef">int</span> k<span style="color:#f92672">,</span> <span style="color:#66d9ef">int</span><span style="color:#f92672">[]</span> prices<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>

    <span style="color:#75715e">/* Corner case */</span>
    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>k <span style="color:#f92672">==</span> 0 <span style="color:#f92672">||</span> prices<span style="color:#f92672">.</span><span style="color:#a6e22e">length</span> <span style="color:#f92672">&lt;</span> 2<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">return</span> 0<span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>

    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>k <span style="color:#f92672">&gt;=</span> prices<span style="color:#f92672">.</span><span style="color:#a6e22e">length</span> <span style="color:#f92672">/</span> 2<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">int</span> max <span style="color:#f92672">=</span> 0<span style="color:#f92672">;</span>
        <span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span><span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> 1<span style="color:#f92672">;</span> i <span style="color:#f92672">&lt;</span> prices<span style="color:#f92672">.</span><span style="color:#a6e22e">length</span><span style="color:#f92672">;</span> i<span style="color:#f92672">++)</span> <span style="color:#f92672">{</span>
            <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>prices<span style="color:#f92672">[</span>i<span style="color:#f92672">]</span> <span style="color:#f92672">-</span> prices<span style="color:#f92672">[</span>i <span style="color:#f92672">-</span> 1<span style="color:#f92672">]</span> <span style="color:#f92672">&gt;</span> 0<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
                max <span style="color:#f92672">+=</span> prices<span style="color:#f92672">[</span>i<span style="color:#f92672">]</span> <span style="color:#f92672">-</span> prices<span style="color:#f92672">[</span>i <span style="color:#f92672">-</span> 1<span style="color:#f92672">];</span>
            <span style="color:#f92672">}</span>
        <span style="color:#f92672">}</span>
        <span style="color:#66d9ef">return</span> max<span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>

    <span style="color:#66d9ef">int</span><span style="color:#f92672">[]</span> state <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#66d9ef">int</span><span style="color:#f92672">[</span>k <span style="color:#f92672">*</span> 2<span style="color:#f92672">];</span>
    state<span style="color:#f92672">[</span>0<span style="color:#f92672">]</span> <span style="color:#f92672">=</span> <span style="color:#f92672">-</span>prices<span style="color:#f92672">[</span>0<span style="color:#f92672">];</span>
    <span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span><span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> 1<span style="color:#f92672">;</span> i <span style="color:#f92672">&lt;</span> state<span style="color:#f92672">.</span><span style="color:#a6e22e">length</span><span style="color:#f92672">;</span> i<span style="color:#f92672">++)</span> <span style="color:#f92672">{</span>
        state<span style="color:#f92672">[</span>i<span style="color:#f92672">]</span> <span style="color:#f92672">=</span> Integer<span style="color:#f92672">.</span><span style="color:#a6e22e">MIN_VALUE</span><span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>

    <span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span><span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> 1<span style="color:#f92672">;</span> i <span style="color:#f92672">&lt;</span> prices<span style="color:#f92672">.</span><span style="color:#a6e22e">length</span><span style="color:#f92672">;</span> i<span style="color:#f92672">++)</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span><span style="color:#66d9ef">int</span> j <span style="color:#f92672">=</span> 0<span style="color:#f92672">;</span> j <span style="color:#f92672">&lt;</span> state<span style="color:#f92672">.</span><span style="color:#a6e22e">length</span><span style="color:#f92672">;</span> j<span style="color:#f92672">++)</span> <span style="color:#f92672">{</span>

            <span style="color:#75715e">/* State transition */</span>
            <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>j <span style="color:#f92672">==</span> 0<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
                state<span style="color:#f92672">[</span>j<span style="color:#f92672">]</span> <span style="color:#f92672">=</span> Integer<span style="color:#f92672">.</span><span style="color:#a6e22e">max</span><span style="color:#f92672">(</span>state<span style="color:#f92672">[</span>j<span style="color:#f92672">],</span> <span style="color:#f92672">-</span>prices<span style="color:#f92672">[</span>i<span style="color:#f92672">]);</span>
            <span style="color:#f92672">}</span> <span style="color:#66d9ef">else</span> <span style="color:#f92672">{</span>
                state<span style="color:#f92672">[</span>j<span style="color:#f92672">]</span> <span style="color:#f92672">=</span> Integer<span style="color:#f92672">.</span><span style="color:#a6e22e">max</span><span style="color:#f92672">(</span>state<span style="color:#f92672">[</span>j<span style="color:#f92672">],</span> <span style="color:#f92672">(</span>j <span style="color:#f92672">%</span> 2 <span style="color:#f92672">==</span> 0 <span style="color:#f92672">?</span> state<span style="color:#f92672">[</span>j <span style="color:#f92672">-</span> 1<span style="color:#f92672">]</span> <span style="color:#f92672">-</span> prices<span style="color:#f92672">[</span>i<span style="color:#f92672">]</span> <span style="color:#f92672">:</span> state<span style="color:#f92672">[</span>j <span style="color:#f92672">-</span> 1<span style="color:#f92672">]</span> <span style="color:#f92672">+</span> prices<span style="color:#f92672">[</span>i<span style="color:#f92672">]));</span>
            <span style="color:#f92672">}</span>
        <span style="color:#f92672">}</span>
    <span style="color:#f92672">}</span>

    <span style="color:#66d9ef">return</span> Math<span style="color:#f92672">.</span><span style="color:#a6e22e">max</span><span style="color:#f92672">(</span>0<span style="color:#f92672">,</span> state<span style="color:#f92672">[</span>state<span style="color:#f92672">.</span><span style="color:#a6e22e">length</span> <span style="color:#f92672">-</span> 1<span style="color:#f92672">]);</span>
<span style="color:#f92672">}</span>
</code></pre></div><h1 id="122-best-time-to-buy-and-sell-stock-ii">122. Best Time to Buy and Sell Stock II</h1>
<p>Link: <a href="https://leetcode.com/problems/best-time-to-buy-and-sell-stock-ii">Best Time to Buy and Sell Stock II</a></p>
<h2 id="problem-description-3">Problem description</h2>
<p>Say you have an array for which the <em>i</em>th element is the price of a given stock on day <em>i</em>.</p>
<p>Design an algorithm to find the maximum profit. You may complete as many transactions as you like (i.e., buy one and sell one share of the stock multiple times).</p>
<p><strong>Note:</strong> You may not engage in multiple transactions at the same time (i.e., you must sell the stock before you buy again).</p>
<p><strong>Example 1:</strong></p>
<pre><code>Input: [7,1,5,3,6,4]
Output: 7
Explanation: Buy on day 2 (price = 1) and sell on day 3 (price = 5), profit = 5-1 = 4.
             Then buy on day 4 (price = 3) and sell on day 5 (price = 6), profit = 6-3 = 3.
</code></pre><p><strong>Example 2:</strong></p>
<pre><code>Input: [1,2,3,4,5]
Output: 4
Explanation: Buy on day 1 (price = 1) and sell on day 5 (price = 5), profit = 5-1 = 4.
             Note that you cannot buy on day 1, buy on day 2 and sell them later, as you are
             engaging multiple transactions at the same time. You must sell before buying again.
</code></pre><p><strong>Example 3:</strong></p>
<pre><code>Input: [7,6,4,3,1]
Output: 0
Explanation: In this case, no transaction is done, i.e. max profit = 0.
</code></pre><h2 id="method--code-3">Method &amp; Code</h2>
<p>This problem can be solved by dynamic programming. However, the description is somehow vague. Therefore, the directly solution is extremely straightforward: add all positive difference to profit. That’s it.</p>
<p>The difference between this problem and <a href="https://leetcode.com/problems/best-time-to-buy-and-sell-stock/">previous problem</a> is that in the previous problem, one “transaction” can be done, which suggests that the purpose is to find largest gap between two numbers in array. And in this problem, since no limits of “transaction”, the purpose turns to simply find each positive gap between adjacent numbers.</p>
<h3 id="dynamic-programming-3">Dynamic Programming</h3>
<p>State transition:</p>
<ul>
<li><code>buy[i] = max(sell[i - 1] - price[i], buy[i - 1])</code></li>
<li><code>sell[i]= max(sell[i - 1], buy[i] + price[i])</code></li>
</ul>
<p>Base case:</p>
<ul>
<li><code>buy[0] = -prices[0]</code></li>
<li><code>sell[0] = 0</code></li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#75715e">/**
</span><span style="color:#75715e"> * Dynamic programming.
</span><span style="color:#75715e"> * State transition:
</span><span style="color:#75715e"> * buy[i] = max(sell[i - 1] - price[i], buy[i - 1])
</span><span style="color:#75715e"> * sell[i]= max(sell[i - 1], buy[i] + price[i])
</span><span style="color:#75715e"> * Base case:
</span><span style="color:#75715e"> * buy[0] = -prices[0];
</span><span style="color:#75715e"> * sell[0] = 0;
</span><span style="color:#75715e"> *
</span><span style="color:#75715e"> * @param prices given array
</span><span style="color:#75715e"> * @return max profit
</span><span style="color:#75715e"> */</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">int</span> <span style="color:#a6e22e">maxProfit</span><span style="color:#f92672">(</span><span style="color:#66d9ef">int</span><span style="color:#f92672">[]</span> prices<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>

    <span style="color:#75715e">/* Corner case */</span>
    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>prices <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span> <span style="color:#f92672">||</span> prices<span style="color:#f92672">.</span><span style="color:#a6e22e">length</span> <span style="color:#f92672">&lt;</span> 2<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">return</span> 0<span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>

    <span style="color:#66d9ef">int</span> n <span style="color:#f92672">=</span> prices<span style="color:#f92672">.</span><span style="color:#a6e22e">length</span><span style="color:#f92672">;</span>
    <span style="color:#66d9ef">int</span><span style="color:#f92672">[]</span> buy <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#66d9ef">int</span><span style="color:#f92672">[</span>n<span style="color:#f92672">];</span>
    <span style="color:#66d9ef">int</span><span style="color:#f92672">[]</span> sell <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#66d9ef">int</span><span style="color:#f92672">[</span>n<span style="color:#f92672">];</span>
    buy<span style="color:#f92672">[</span>0<span style="color:#f92672">]</span> <span style="color:#f92672">=</span> <span style="color:#f92672">-</span>prices<span style="color:#f92672">[</span>0<span style="color:#f92672">];</span>
    sell<span style="color:#f92672">[</span>0<span style="color:#f92672">]</span> <span style="color:#f92672">=</span> 0<span style="color:#f92672">;</span>

    <span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span><span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> 1<span style="color:#f92672">;</span> i <span style="color:#f92672">&lt;</span> n<span style="color:#f92672">;</span> i<span style="color:#f92672">++)</span> <span style="color:#f92672">{</span>
        buy<span style="color:#f92672">[</span>i<span style="color:#f92672">]</span> <span style="color:#f92672">=</span> Math<span style="color:#f92672">.</span><span style="color:#a6e22e">max</span><span style="color:#f92672">(</span>sell<span style="color:#f92672">[</span>i <span style="color:#f92672">-</span> 1<span style="color:#f92672">]</span> <span style="color:#f92672">-</span> prices<span style="color:#f92672">[</span>i<span style="color:#f92672">],</span> buy<span style="color:#f92672">[</span>i <span style="color:#f92672">-</span> 1<span style="color:#f92672">]);</span>
        sell<span style="color:#f92672">[</span>i<span style="color:#f92672">]</span> <span style="color:#f92672">=</span> Math<span style="color:#f92672">.</span><span style="color:#a6e22e">max</span><span style="color:#f92672">(</span>sell<span style="color:#f92672">[</span>i <span style="color:#f92672">-</span> 1<span style="color:#f92672">],</span> buy<span style="color:#f92672">[</span>i<span style="color:#f92672">]</span> <span style="color:#f92672">+</span> prices<span style="color:#f92672">[</span>i<span style="color:#f92672">]);</span>
    <span style="color:#f92672">}</span>

    <span style="color:#66d9ef">return</span> sell<span style="color:#f92672">[</span>n <span style="color:#f92672">-</span> 1<span style="color:#f92672">];</span>
<span style="color:#f92672">}</span>
</code></pre></div><h3 id="greedy-1">Greedy</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#75715e">/**
</span><span style="color:#75715e"> * Greedy.
</span><span style="color:#75715e"> *
</span><span style="color:#75715e"> * @param prices given array
</span><span style="color:#75715e"> * @return max profit
</span><span style="color:#75715e"> */</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">int</span> <span style="color:#a6e22e">maxProfitGreedy</span><span style="color:#f92672">(</span><span style="color:#66d9ef">int</span><span style="color:#f92672">[]</span> prices<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">int</span> max <span style="color:#f92672">=</span> 0<span style="color:#f92672">;</span>
    <span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span><span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> 1<span style="color:#f92672">;</span> i <span style="color:#f92672">&lt;</span> prices<span style="color:#f92672">.</span><span style="color:#a6e22e">length</span><span style="color:#f92672">;</span> i<span style="color:#f92672">++)</span> <span style="color:#f92672">{</span>
        max <span style="color:#f92672">=</span> prices<span style="color:#f92672">[</span>i<span style="color:#f92672">]</span> <span style="color:#f92672">&gt;</span> prices<span style="color:#f92672">[</span>i <span style="color:#f92672">-</span> 1<span style="color:#f92672">]</span> <span style="color:#f92672">?</span> max <span style="color:#f92672">+</span> prices<span style="color:#f92672">[</span>i<span style="color:#f92672">]</span> <span style="color:#f92672">-</span> prices<span style="color:#f92672">[</span>i <span style="color:#f92672">-</span> 1<span style="color:#f92672">]</span> <span style="color:#f92672">:</span> max<span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>
    
    <span style="color:#66d9ef">return</span> max<span style="color:#f92672">;</span>
<span style="color:#f92672">}</span>
</code></pre></div><h1 id="309-best-time-to-buy-and-sell-stock-with-cooldown">309. Best Time to Buy and Sell Stock with Cooldown</h1>
<p>Link: <a href="https://leetcode.com/problems/best-time-to-buy-and-sell-stock-with-cooldown/">Best Time to Buy and Sell Stock with Cooldown</a></p>
<h2 id="problem-description-4">Problem description</h2>
<p>Say you have an array for which the <code>ith</code> element is the price of a given stock on day <em>i</em>.</p>
<p>Design an algorithm to find the maximum profit. You may complete as many transactions as you like (ie, buy one and sell one share of the stock multiple times) with the following restrictions:</p>
<ul>
<li>You may not engage in multiple transactions at the same time (ie, you must sell the stock before you buy again).</li>
<li>After you sell your stock, you cannot buy stock on next day. (ie, cooldown 1 day)</li>
</ul>
<p><strong>Example:</strong></p>
<pre><code>Input: [1,2,3,0,2]
Output: 3 
Explanation: transactions = [buy, sell, cooldown, buy, sell]
</code></pre><h2 id="method--code-4">Method &amp; Code</h2>
<h3 id="dynamic-programming-4">Dynamic Programming</h3>
<p>State transition:</p>
<ul>
<li><code>buy[i] = max(sell[i - 2] - price, buy[i - 1])</code>, maximum profit end with buying on day i or end with buying on a day before i.</li>
<li><code>sell[i] = max(buy[i - 1] + price, sell[i - 1])</code>, maximum profit end with selling on day i or end with selling on a day before i</li>
</ul>
<p>Base cases:</p>
<ul>
<li><code>buy[0] = -price[0]</code></li>
<li><code>sell[0] = 0</code></li>
<li><code>buy[1] = Math.max(-prices[0], -prices[1]</code></li>
<li><code>sell[1] = Math.max(buy[0] + prices[1], sell[0])</code></li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#75715e">/**
</span><span style="color:#75715e"> * Dynamic programming.
</span><span style="color:#75715e"> * State transition:
</span><span style="color:#75715e"> * buy[i] = max(sell[i - 2] - price, buy[i - 1])
</span><span style="color:#75715e"> * sell[i] = max(buy[i - 1] + price, sell[i - 1])
</span><span style="color:#75715e"> * Base cases:
</span><span style="color:#75715e"> * buy[0] = -price[0]
</span><span style="color:#75715e"> * sell[0] = 0
</span><span style="color:#75715e"> * buy[1] = Math.max(-prices[0], -prices[1]
</span><span style="color:#75715e"> * sell[1] = Math.max(buy[0] + prices[1], sell[0])
</span><span style="color:#75715e"> *
</span><span style="color:#75715e"> * @param prices given int array
</span><span style="color:#75715e"> * @return max profit
</span><span style="color:#75715e"> */</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">int</span> <span style="color:#a6e22e">maxProfit</span><span style="color:#f92672">(</span><span style="color:#66d9ef">int</span><span style="color:#f92672">[]</span> prices<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>

    <span style="color:#75715e">/* Corner case */</span>
    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>prices <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span> <span style="color:#f92672">||</span> prices<span style="color:#f92672">.</span><span style="color:#a6e22e">length</span> <span style="color:#f92672">&lt;</span> 2<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">return</span> 0<span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>

    <span style="color:#66d9ef">int</span> n <span style="color:#f92672">=</span> prices<span style="color:#f92672">.</span><span style="color:#a6e22e">length</span><span style="color:#f92672">;</span>
    <span style="color:#66d9ef">int</span><span style="color:#f92672">[]</span> buy <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#66d9ef">int</span><span style="color:#f92672">[</span>n<span style="color:#f92672">];</span>     <span style="color:#75715e">// maximum profit end with buying on day i or end with buying on a day before i
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">int</span><span style="color:#f92672">[]</span> sell <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#66d9ef">int</span><span style="color:#f92672">[</span>n<span style="color:#f92672">];</span>    <span style="color:#75715e">// maximum profit end with selling on day i or end with selling on a day before i
</span><span style="color:#75715e"></span>    buy<span style="color:#f92672">[</span>0<span style="color:#f92672">]</span> <span style="color:#f92672">=</span> <span style="color:#f92672">-</span>prices<span style="color:#f92672">[</span>0<span style="color:#f92672">];</span>
    sell<span style="color:#f92672">[</span>0<span style="color:#f92672">]</span> <span style="color:#f92672">=</span> 0<span style="color:#f92672">;</span>
    buy<span style="color:#f92672">[</span>1<span style="color:#f92672">]</span> <span style="color:#f92672">=</span> Math<span style="color:#f92672">.</span><span style="color:#a6e22e">max</span><span style="color:#f92672">(-</span>prices<span style="color:#f92672">[</span>0<span style="color:#f92672">],</span> <span style="color:#f92672">-</span>prices<span style="color:#f92672">[</span>1<span style="color:#f92672">]);</span>          <span style="color:#75715e">// either buy first or buy second
</span><span style="color:#75715e"></span>    sell<span style="color:#f92672">[</span>1<span style="color:#f92672">]</span> <span style="color:#f92672">=</span> Math<span style="color:#f92672">.</span><span style="color:#a6e22e">max</span><span style="color:#f92672">(</span>buy<span style="color:#f92672">[</span>0<span style="color:#f92672">]</span> <span style="color:#f92672">+</span> prices<span style="color:#f92672">[</span>1<span style="color:#f92672">],</span> sell<span style="color:#f92672">[</span>0<span style="color:#f92672">]);</span>

    <span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span><span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> 2<span style="color:#f92672">;</span> i <span style="color:#f92672">&lt;</span> n<span style="color:#f92672">;</span> i<span style="color:#f92672">++)</span> <span style="color:#f92672">{</span>       <span style="color:#75715e">// starts at day 2
</span><span style="color:#75715e"></span>        buy<span style="color:#f92672">[</span>i<span style="color:#f92672">]</span> <span style="color:#f92672">=</span> Math<span style="color:#f92672">.</span><span style="color:#a6e22e">max</span><span style="color:#f92672">(</span>buy<span style="color:#f92672">[</span>i <span style="color:#f92672">-</span> 1<span style="color:#f92672">],</span> sell<span style="color:#f92672">[</span>i <span style="color:#f92672">-</span> 2<span style="color:#f92672">]</span> <span style="color:#f92672">-</span> prices<span style="color:#f92672">[</span>i<span style="color:#f92672">]);</span>
        sell<span style="color:#f92672">[</span>i<span style="color:#f92672">]</span> <span style="color:#f92672">=</span> Math<span style="color:#f92672">.</span><span style="color:#a6e22e">max</span><span style="color:#f92672">(</span>sell<span style="color:#f92672">[</span>i <span style="color:#f92672">-</span> 1<span style="color:#f92672">],</span> buy<span style="color:#f92672">[</span>i <span style="color:#f92672">-</span> 1<span style="color:#f92672">]</span> <span style="color:#f92672">+</span> prices<span style="color:#f92672">[</span>i<span style="color:#f92672">]);</span>
    <span style="color:#f92672">}</span>

    <span style="color:#66d9ef">return</span> sell<span style="color:#f92672">[</span>n <span style="color:#f92672">-</span> 1<span style="color:#f92672">];</span>
<span style="color:#f92672">}</span>
</code></pre></div><h3 id="optimized-dynamic-programming">Optimized Dynamic Programming</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#75715e">/**
</span><span style="color:#75715e"> * Reduce space complexity to O(1).
</span><span style="color:#75715e"> *
</span><span style="color:#75715e"> * @param prices given int array
</span><span style="color:#75715e"> * @return max profit
</span><span style="color:#75715e"> */</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">int</span> <span style="color:#a6e22e">maxProfitOptimized</span><span style="color:#f92672">(</span><span style="color:#66d9ef">int</span><span style="color:#f92672">[]</span> prices<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>

    <span style="color:#75715e">/* Corner case */</span>
    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>prices <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span> <span style="color:#f92672">||</span> prices<span style="color:#f92672">.</span><span style="color:#a6e22e">length</span> <span style="color:#f92672">&lt;</span> 2<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">return</span> 0<span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>

    <span style="color:#66d9ef">int</span> b0 <span style="color:#f92672">=</span> <span style="color:#f92672">-</span>prices<span style="color:#f92672">[</span>0<span style="color:#f92672">],</span> s0 <span style="color:#f92672">=</span> 0<span style="color:#f92672">;</span>    <span style="color:#75715e">// state 0, purchase is allowed, but sell is not allowed
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">int</span> s1 <span style="color:#f92672">=</span> 0<span style="color:#f92672">,</span> s2 <span style="color:#f92672">=</span> 0<span style="color:#f92672">;</span>             <span style="color:#75715e">// at state 0, sell[i - 1], sell[i - 2] does not exist
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">int</span> b1 <span style="color:#f92672">=</span> b0<span style="color:#f92672">;</span>                    <span style="color:#75715e">// buy[i - 1] is buy[0] when i == 1
</span><span style="color:#75715e"></span>
    <span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span><span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> 1<span style="color:#f92672">;</span> i <span style="color:#f92672">&lt;</span> prices<span style="color:#f92672">.</span><span style="color:#a6e22e">length</span><span style="color:#f92672">;</span> i<span style="color:#f92672">++)</span> <span style="color:#f92672">{</span>       <span style="color:#75715e">// starts at day 1
</span><span style="color:#75715e"></span>        b0 <span style="color:#f92672">=</span> Math<span style="color:#f92672">.</span><span style="color:#a6e22e">max</span><span style="color:#f92672">(</span>b1<span style="color:#f92672">,</span> s2 <span style="color:#f92672">-</span> prices<span style="color:#f92672">[</span>i<span style="color:#f92672">]);</span>      <span style="color:#75715e">// b0: buy[i]
</span><span style="color:#75715e"></span>        s0 <span style="color:#f92672">=</span> Math<span style="color:#f92672">.</span><span style="color:#a6e22e">max</span><span style="color:#f92672">(</span>s1<span style="color:#f92672">,</span> b1 <span style="color:#f92672">+</span> prices<span style="color:#f92672">[</span>i<span style="color:#f92672">]);</span>      <span style="color:#75715e">// s0: sell[i]
</span><span style="color:#75715e"></span>        b1 <span style="color:#f92672">=</span> b0<span style="color:#f92672">;</span>        <span style="color:#75715e">// b1: buy[i - 1]
</span><span style="color:#75715e"></span>        s2 <span style="color:#f92672">=</span> s1<span style="color:#f92672">;</span>        <span style="color:#75715e">// s2: sell[i - 2]
</span><span style="color:#75715e"></span>        s1 <span style="color:#f92672">=</span> s0<span style="color:#f92672">;</span>        <span style="color:#75715e">// s1: sell[i - 1]
</span><span style="color:#75715e"></span>    <span style="color:#f92672">}</span>

    <span style="color:#66d9ef">return</span> s0<span style="color:#f92672">;</span>
<span style="color:#f92672">}</span>
</code></pre></div><h1 id="714-best-time-to-buy-and-sell-stock-with-transaction-fee">714. Best Time to Buy and Sell Stock with Transaction Fee</h1>
<p>Link: <a href="https://leetcode.com/problems/best-time-to-buy-and-sell-stock-with-transaction-fee/">Best Time to Buy and Sell Stock with Transaction Fee</a></p>
<h2 id="problem-description-5">Problem description</h2>
<p>Your are given an array of integers <code>prices</code>, for which the <code>i</code>-th element is the price of a given stock on day <code>i</code>; and a non-negative integer <code>fee</code> representing a transaction fee.</p>
<p>You may complete as many transactions as you like, but you need to pay the transaction fee for each transaction. You may not buy more than 1 share of a stock at a time (ie. you must sell the stock share before you buy again.)</p>
<p>Return the maximum profit you can make.</p>
<p><strong>Example 1:</strong></p>
<pre><code>Input: prices = [1, 3, 2, 8, 4, 9], fee = 2
Output: 8
Explanation: The maximum profit can be achieved by:
Buying at prices[0] = 1Selling at prices[3] = 8Buying at prices[4] = 4Selling at prices[5] = 9The total profit is ((8 - 1) - 2) + ((9 - 4) - 2) = 8.
</code></pre><p><strong>Note:</strong></p>
<p><code>0 &lt; prices.length &lt;= 50000</code>.</p>
<p><code>0 &lt; prices[i] &lt; 50000</code>.</p>
<p><code>0 &lt;= fee &lt; 50000</code>.</p>
<h2 id="method--code-5">Method &amp; Code</h2>
<h3 id="dynamic-programming-5">Dynamic Programming</h3>
<p>State transition:</p>
<ul>
<li><code>buy[i] = max(sell[i - 1] - price[i], buy[i - 1])</code>, maximum profit end with buying on day i or end with buying on a day before i.</li>
<li><code>sell[i] = max(buy[i - 1] + price - fee, sell[i - 1])</code>, maximum profit end with selling on day i or end with selling on a day before i</li>
</ul>
<p>Base cases:</p>
<ul>
<li><code>buy[0] = -price[0]</code></li>
<li><code>sell[0] = 0</code></li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#75715e">/**
</span><span style="color:#75715e"> * Dynamic programming.
</span><span style="color:#75715e"> * State transition:
</span><span style="color:#75715e"> * buy[i] = max(sell[i - 1] - price[i], buy[i - 1])
</span><span style="color:#75715e"> * sell[i] = max(buy[i - 1] + price[i] - fee, sell[i - 1])
</span><span style="color:#75715e"> * Base cases:
</span><span style="color:#75715e"> * buy[0] = -price[0]
</span><span style="color:#75715e"> * sell[0] = 0
</span><span style="color:#75715e"> *
</span><span style="color:#75715e"> * @param prices given array
</span><span style="color:#75715e"> * @param fee    transaction fee
</span><span style="color:#75715e"> * @return max profit
</span><span style="color:#75715e"> */</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">int</span> <span style="color:#a6e22e">maxProfit</span><span style="color:#f92672">(</span><span style="color:#66d9ef">int</span><span style="color:#f92672">[]</span> prices<span style="color:#f92672">,</span> <span style="color:#66d9ef">int</span> fee<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>

    <span style="color:#75715e">/* Corner case */</span>
    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>prices <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span> <span style="color:#f92672">||</span> prices<span style="color:#f92672">.</span><span style="color:#a6e22e">length</span> <span style="color:#f92672">&lt;</span> 2<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">return</span> 0<span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>

    <span style="color:#66d9ef">int</span> n <span style="color:#f92672">=</span> prices<span style="color:#f92672">.</span><span style="color:#a6e22e">length</span><span style="color:#f92672">;</span>
    <span style="color:#66d9ef">int</span><span style="color:#f92672">[]</span> buy <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#66d9ef">int</span><span style="color:#f92672">[</span>n<span style="color:#f92672">];</span>
    <span style="color:#66d9ef">int</span><span style="color:#f92672">[]</span> sell <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#66d9ef">int</span><span style="color:#f92672">[</span>n<span style="color:#f92672">];</span>
    buy<span style="color:#f92672">[</span>0<span style="color:#f92672">]</span> <span style="color:#f92672">=</span> <span style="color:#f92672">-</span>prices<span style="color:#f92672">[</span>0<span style="color:#f92672">];</span>

    <span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span><span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> 1<span style="color:#f92672">;</span> i <span style="color:#f92672">&lt;</span> n<span style="color:#f92672">;</span> i<span style="color:#f92672">++)</span> <span style="color:#f92672">{</span>
        buy<span style="color:#f92672">[</span>i<span style="color:#f92672">]</span> <span style="color:#f92672">=</span> Math<span style="color:#f92672">.</span><span style="color:#a6e22e">max</span><span style="color:#f92672">(</span>sell<span style="color:#f92672">[</span>i <span style="color:#f92672">-</span> 1<span style="color:#f92672">]</span> <span style="color:#f92672">-</span> prices<span style="color:#f92672">[</span>i<span style="color:#f92672">],</span> buy<span style="color:#f92672">[</span>i <span style="color:#f92672">-</span> 1<span style="color:#f92672">]);</span>
        sell<span style="color:#f92672">[</span>i<span style="color:#f92672">]</span> <span style="color:#f92672">=</span> Math<span style="color:#f92672">.</span><span style="color:#a6e22e">max</span><span style="color:#f92672">(</span>buy<span style="color:#f92672">[</span>i <span style="color:#f92672">-</span> 1<span style="color:#f92672">]</span> <span style="color:#f92672">+</span> prices<span style="color:#f92672">[</span>i<span style="color:#f92672">]</span> <span style="color:#f92672">-</span> fee<span style="color:#f92672">,</span> sell<span style="color:#f92672">[</span>i <span style="color:#f92672">-</span> 1<span style="color:#f92672">]);</span>
    <span style="color:#f92672">}</span>

    <span style="color:#66d9ef">return</span> sell<span style="color:#f92672">[</span>n <span style="color:#f92672">-</span> 1<span style="color:#f92672">];</span>
<span style="color:#f92672">}</span>
</code></pre></div><h3 id="optimized-dynamic-programming-1">Optimized Dynamic Programming</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#75715e">/**
</span><span style="color:#75715e"> * Reduce space complexity to O(1).
</span><span style="color:#75715e"> *
</span><span style="color:#75715e"> * @param prices given int array
</span><span style="color:#75715e"> * @return max profit
</span><span style="color:#75715e"> */</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">int</span> <span style="color:#a6e22e">maxProfitOptimized</span><span style="color:#f92672">(</span><span style="color:#66d9ef">int</span><span style="color:#f92672">[]</span> prices<span style="color:#f92672">,</span> <span style="color:#66d9ef">int</span> fee<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>

    <span style="color:#75715e">/* Corner case */</span>
    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>prices <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span> <span style="color:#f92672">||</span> prices<span style="color:#f92672">.</span><span style="color:#a6e22e">length</span> <span style="color:#f92672">&lt;</span> 2<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">return</span> 0<span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>

    <span style="color:#66d9ef">int</span> b0 <span style="color:#f92672">=</span> <span style="color:#f92672">-</span>prices<span style="color:#f92672">[</span>0<span style="color:#f92672">],</span> s0 <span style="color:#f92672">=</span> 0<span style="color:#f92672">;</span>    <span style="color:#75715e">// state 0, purchase is allowed, but sell is not allowed
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">int</span> s1 <span style="color:#f92672">=</span> 0<span style="color:#f92672">;</span>                     <span style="color:#75715e">// at state 0, sell[i - 1] does not exist
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">int</span> b1 <span style="color:#f92672">=</span> b0<span style="color:#f92672">;</span>                    <span style="color:#75715e">// buy[i - 1] is buy[0] when i == 1
</span><span style="color:#75715e"></span>
    <span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span><span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> 1<span style="color:#f92672">;</span> i <span style="color:#f92672">&lt;</span> prices<span style="color:#f92672">.</span><span style="color:#a6e22e">length</span><span style="color:#f92672">;</span> i<span style="color:#f92672">++)</span> <span style="color:#f92672">{</span>       <span style="color:#75715e">// starts at day 1
</span><span style="color:#75715e"></span>        b0 <span style="color:#f92672">=</span> Math<span style="color:#f92672">.</span><span style="color:#a6e22e">max</span><span style="color:#f92672">(</span>s1 <span style="color:#f92672">-</span> prices<span style="color:#f92672">[</span>i<span style="color:#f92672">],</span> b1<span style="color:#f92672">);</span>
        s0 <span style="color:#f92672">=</span> Math<span style="color:#f92672">.</span><span style="color:#a6e22e">max</span><span style="color:#f92672">(</span>b0 <span style="color:#f92672">+</span> prices<span style="color:#f92672">[</span>i<span style="color:#f92672">]</span> <span style="color:#f92672">-</span> fee<span style="color:#f92672">,</span> s1<span style="color:#f92672">);</span>
        b1 <span style="color:#f92672">=</span> b0<span style="color:#f92672">;</span>
        s1 <span style="color:#f92672">=</span> s0<span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>

    <span style="color:#66d9ef">return</span> s0<span style="color:#f92672">;</span>
<span style="color:#f92672">}</span>
</code></pre></div>
              
            </div>
          </div>
          <div id="post-footer" class="post-footer main-content-wrap">
            
              
                
                
                  <div class="post-footer-tags">
                    <span class="text-color-light text-small">TAGGED IN</span><br/>
                    
  <a class="tag tag--primary tag--small" href="https://yy-zhou.github.io/tags/dynamic-programming/">Dynamic Programming</a>

  <a class="tag tag--primary tag--small" href="https://yy-zhou.github.io/tags/state-machine/">State Machine</a>

  <a class="tag tag--primary tag--small" href="https://yy-zhou.github.io/tags/greedy/">Greedy</a>

                  </div>
                
              
            
            <div class="post-actions-wrap">
  
      <nav >
        <ul class="post-actions post-action-nav">
          
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default tooltip--top" href="https://yy-zhou.github.io/2020/03/lc-54-59-498-matrix-traverse/" data-tooltip="LC 54 59 498 - Matrix Traverse">
              
                  <i class="fa fa-angle-left"></i>
                  <span class="hide-xs hide-sm text-small icon-ml">NEXT</span>
                </a>
            </li>
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default tooltip--top" href="https://yy-zhou.github.io/2020/03/lc-375-486-877-dynamic-programming-minimax/" data-tooltip="LC 375 486 877 - Dynamic Programming: Minimax">
              
                  <span class="hide-xs hide-sm text-small icon-mr">PREVIOUS</span>
                  <i class="fa fa-angle-right"></i>
                </a>
            </li>
          
        </ul>
      </nav>
    <ul class="post-actions post-action-share" >
      
        <li class="post-action hide-lg hide-md hide-sm">
          <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions">
            <i class="fa fa-share-alt"></i>
          </a>
        </li>
        
      
      
      <li class="post-action">
        
          <a class="post-action-btn btn btn--default" href="#table-of-contents">
        
          <i class="fa fa-list"></i>
        </a>
      </li>
    </ul>
  
</div>

            
              
            
          </div>
        </article>
        <footer id="footer" class="main-content-wrap">
  <span class="copyrights">
    &copy; 2020 <a href="https://github.com/yyzhou95">BorisMirage</a>. All Rights Reserved
  </span>
</footer>

      </div>
      <div id="bottom-bar" class="post-bottom-bar" data-behavior="2">
        <div class="post-actions-wrap">
  
      <nav >
        <ul class="post-actions post-action-nav">
          
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default tooltip--top" href="https://yy-zhou.github.io/2020/03/lc-54-59-498-matrix-traverse/" data-tooltip="LC 54 59 498 - Matrix Traverse">
              
                  <i class="fa fa-angle-left"></i>
                  <span class="hide-xs hide-sm text-small icon-ml">NEXT</span>
                </a>
            </li>
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default tooltip--top" href="https://yy-zhou.github.io/2020/03/lc-375-486-877-dynamic-programming-minimax/" data-tooltip="LC 375 486 877 - Dynamic Programming: Minimax">
              
                  <span class="hide-xs hide-sm text-small icon-mr">PREVIOUS</span>
                  <i class="fa fa-angle-right"></i>
                </a>
            </li>
          
        </ul>
      </nav>
    <ul class="post-actions post-action-share" >
      
        <li class="post-action hide-lg hide-md hide-sm">
          <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions">
            <i class="fa fa-share-alt"></i>
          </a>
        </li>
        
      
      
      <li class="post-action">
        
          <a class="post-action-btn btn btn--default" href="#table-of-contents">
        
          <i class="fa fa-list"></i>
        </a>
      </li>
    </ul>
  
</div>

      </div>
      <div id="share-options-bar" class="share-options-bar" data-behavior="2">
  <i id="btn-close-shareoptions" class="fa fa-close"></i>
  <ul class="share-options">
    
  </ul>
</div>
<div id="share-options-mask" class="share-options-mask"></div>
    </div>
    
    <div id="about">
  <div id="about-card">
    <div id="about-btn-close">
      <i class="fa fa-remove"></i>
    </div>
    
      <img id="about-card-picture" src="https://yy-zhou.github.io/img/avatar.jpg" alt="Author&#39;s picture" />
    
    <h4 id="about-card-name">Notebook</h4>
    
      <div id="about-card-bio">Bingo!</div>
    
    
      <div id="about-card-job">
        <i class="fa fa-briefcase"></i>
        <br/>
        Software Engineer
      </div>
    
    
      <div id="about-card-location">
        <i class="fa fa-map-marker"></i>
        <br/>
        San Jose
      </div>
    
  </div>
</div>

    

    
  
    
      <div id="cover" style="background-image:url('https://yy-zhou.github.io/img/bg.jpeg');"></div>
    
  


    
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.2.4/jquery.min.js" integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44=" crossorigin="anonymous"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js" integrity="sha256-/BfiIkHlHoVihZdc6TFuj7MmJ0TWcWsMXkeDFwhi0zw=" crossorigin="anonymous"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.7/js/jquery.fancybox.min.js" integrity="sha256-GEAnjcTqVP+vBp3SSc8bEDQqvWAZMiHyUSIorrWwH50=" crossorigin="anonymous"></script>


<script src="https://yy-zhou.github.io/js/script-pcw6v3xilnxydl1vddzazdverrnn9ctynvnxgwho987mfyqkuylcb1nlt.min.js"></script>


<script lang="javascript">
window.onload = updateMinWidth;
window.onresize = updateMinWidth;
document.getElementById("sidebar").addEventListener("transitionend", updateMinWidth);
function updateMinWidth() {
  var sidebar = document.getElementById("sidebar");
  var main = document.getElementById("main");
  main.style.minWidth = "";
  var w1 = getComputedStyle(main).getPropertyValue("min-width");
  var w2 = getComputedStyle(sidebar).getPropertyValue("width");
  var w3 = getComputedStyle(sidebar).getPropertyValue("left");
  main.style.minWidth = `calc(${w1} - ${w2} - ${w3})`;
}
</script>

<script>
$(document).ready(function() {
  hljs.configure({ classPrefix: '', useBR: false });
  $('pre.code-highlight > code, pre > code').each(function(i, block) {
    if (!$(this).hasClass('codeblock')) {
      $(this).addClass('codeblock');
    }
    hljs.highlightBlock(block);
  });
});
</script>


  
    
  




    
  </body>
</html>

